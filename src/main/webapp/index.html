<!DOCTYPE html>
<!--suppress ALL -->
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>myForm</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css"
          integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <style>
        #header {
            background-color:black;
            color:white;
            text-align:center;
            padding:5px;
        }
        #nav {
            line-height: 15%;
            background-color:#eeeeee;
            height:300px;
            width:150px;
            float:left;
            padding:5px;
        }
        #waste {

            width:35%;
            float:left;
            padding:10px;
        }
        #newform {
            width:50%;
            float:left;
            padding:10px;
        }

        #footer {
            background-color:black;
            color:white;
            clear:both;
            text-align:center;
            padding:5px;
        }
        .remove-btn {
            color: red;
            cursor: pointer;
        }
        #allWastes, #allNewWastes {
            line-height: 25px;
  display: inline-block;
  vertical-align: top;
  width: 45%;
}
#allNewForms, #allForms {
            line-height: 25px;
  display: inline-block;
  vertical-align: top;
  width: 37%;
}
#liczbtn ,#addformatkabtn,#formatkaText,#addscinkabtn,#scinkaText{
            line-height: 25px;
  display: inline-block;
  vertical-align: top;
  width: 20%;
}
    </style>
</head>

<body>
<main>

    <form id="initialForm">
        <div id="header">
            <h1>Kalkulator Formatek</h1>
        </div>
        <div id="nav">
            <p>Info</p><br>
            <p>Reset</p>

        </div>
        <div id="waste">
            <h1>Ścinki</h1>
            <input id="scinkaText" class="pure-input-rounded pure-u-1" name="name" placeholder="scinkaText">

            <button id="addscinkabtn" class="pure-button pure-button-primary pure-u-1">Dodaj ścinki</button>
            <br>
            <fieldset id="allWastes">Dodane ścinki</fieldset>
            <fieldset id="allNewWastes">ścinki po cięciu</fieldset>

        </div>
        <div id="newform">
            <h1>Formatki</h1>
            <input id="formatkaText" class="pure-input-rounded pure-u-1" name="name" placeholder="formatkaText">
            <button id="addformatkabtn" class="pure-button pure-button-primary pure-u-1">Dodaj formatki</button>
            <button id="liczbtn" class="pure-button pure-button-primary pure-u-1-4" STYLE="font-weight: bold; color:blue; background:coral; width:100px; height:50px;">Wykonaj</button>
            <br>
            <fieldset id="allForms">Dodane formatki:</fieldset>
            <fieldset id="allNewForms">Wykonalne formatki:</fieldset>

        </div>

        <div id="footer">
            Copyright © szackie
        </div>
    </form>

</main>

<script>
//ŚCINKI

document.getElementById('addscinkabtn').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the form from submitting normally

        // Get the value from the formatkaText input field
        var scinkaTextValue = document.getElementById('scinkaText').value;

        // Make a POST request to the backend endpoint
        fetch('http://localhost:8080/api/scinka', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                    name: scinkaTextValue
                })
        })
        .then(processOkResponse)
.then(function(responseData) {
    // Get the allForms fieldsetł
    var allWasteFieldset = document.getElementById('allWastes');
        allWasteFieldset.innerHTML = '';

// Create a new list element for each form received from the backend
    responseData.forEach(function(waste) {
        var listItem = document.createElement('li');
        listItem.textContent = listItem.textContent = waste.width + ' x ' + waste.depth + ', ilość: ' + waste.quantity;;

        // Create an image element for the remove button
        var removeButton = document.createElement('img');
        removeButton.src = '/x.png';
        removeButton.classList.add('remove-btn');

        // Add event listener to the remove button
        removeButton.addEventListener('click', function() {
            // Remove the form from the frontend list
            listItem.remove();

            // Send a DELETE request to the backend to remove the form
            fetch('http://localhost:8080/api/scinka/' + waste.id, {
                method: 'DELETE'
            })
            .then(processOkResponse)
            .catch(console.warn);
        });

        // Append the remove button to the list item
        listItem.appendChild(removeButton);

        // Append the list item to the allForms fieldset
        allWasteFieldset.appendChild(listItem);
    });
})
.then(() => scinkaText.value = '');

});


//FORMATKI


    document.getElementById('addformatkabtn').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the form from submitting normally

        // Get the value from the formatkaText input field
        var formatkaTextValue = document.getElementById('formatkaText').value;


        // Make a POST request to the backend endpoint
        fetch('http://localhost:8080/api/formatka', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                    name: formatkaTextValue
                })
        })
        .then(processOkResponse)
.then(function(responseData) {
    // Get the allForms fieldset
    var allFormsFieldset = document.getElementById('allForms');
        allFormsFieldset.innerHTML = '';

// Create a new list element for each form received from the backend
    responseData.forEach(function(form) {
        var listItem = document.createElement('li');
        listItem.textContent = listItem.textContent = form.width + ' x ' + form.depth + ', ilość: ' + form.quantity;;

        // Create an image element for the remove button
        var removeButton = document.createElement('img');
        removeButton.src = 'x.png';
        removeButton.classList.add('remove-btn');

        // Add event listener to the remove button
        removeButton.addEventListener('click', function() {
            // Remove the form from the frontend list
            listItem.remove();

            // Send a DELETE request to the backend to remove the form
            fetch('http://localhost:8080/api/formatka/' + form.id, {
                method: 'DELETE'
            })
            .then(processOkResponse)
            .catch(console.warn);
        });

        // Append the remove button to the list item
        listItem.appendChild(removeButton);

        // Append the list item to the allForms fieldset
        allFormsFieldset.appendChild(listItem);
    });
})
.then(() => formatkaText.value = '');

});
//SOLVE

document.getElementById('liczbtn').addEventListener('click', function(event) {
    event.preventDefault(); // Prevent the form from submitting normally

    // Get the value from the formatkaText input field
    var formatkaTextValue = document.getElementById('formatkaText').value;

    // Make a GET request to the backend endpoint
    fetch('http://localhost:8080/api/solve', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        },
    })
    .then(processOkResponse)
    .then(function(responseData) {
        // Get the allForms fieldset
        var allNewFormsFieldset = document.getElementById('allNewForms');
        var allNewWastesFieldset = document.getElementById('allNewWastes');
        allNewFormsFieldset.innerHTML = '';
        allNewWastesFieldset.innerHTML = '';

        // Create new list elements for new forms and new wastes received from the backend
        responseData.newWastesList.forEach(function(newWaste) {
            var newWastelistItem = document.createElement('li');
            newWastelistItem.textContent = newWaste.width + ' x ' + newWaste.depth ;
            allNewWastesFieldset.appendChild(newWastelistItem);
        });

        responseData.newFormsList.forEach(function(newForm) {
            var newFormlistItem = document.createElement('li');
            newFormlistItem.textContent = newForm.width + ' x ' + newForm.depth + ', wykonalnych: ' + newForm.quantity;
            allNewFormsFieldset.appendChild(newFormlistItem);
        });
    })
    .catch(console.warn);
});
function processOkResponse(response = {}) {
        if (response.ok) {
            return response.json();
        }
        throw new Error(`Status not 200 (${response.status})`);
    }
</script>
</body>
</html>
